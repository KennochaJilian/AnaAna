@using AnaAna.Data.Models
@using AnaAna.Services.ViewModels
@using Microsoft.AspNetCore.Http

@model RetrievePollViewModel;

<h1> @Model.Title </h1>
<p> @Model.Description </p>
<p> @Model.StartedAd </p>
<p> @Model.EndedAt </p>

<p> Categorie : @Model.Category.Name </p>

@if (Model.userIsCreator && !Model.IsDisabled)
{
    <div class="btn btn-primary" onclick="desactivatePoll()"> Désactiver le sondage </div>
}

<p> Voir les resultats <a href="~/Results/index?pollId=@Model.Id"> ici </a></p>

@if (Model.IsDisabled)
{
    <p> Sondage desactivé :) </p>
}

<p> Nombre de votant(s) = @Model.nbVoted</p>





<form asp-action=@ViewData["mode"]>

    <input id="pollId" type="hidden" name="pollId" value="@Model.Id">

    @if (Model.HasMultipleChoice)
    {
        <p> Choisis une ou plusieurs réponses :</p>


        @foreach (Choice choice in Model.Choices)
        {

            <div class="form-check">

                @if (Model.ChoicesSelected != null && Model.ChoicesSelected.Any(x => x.Id == choice.Id))
                {

                    <input class="form-check-input" type="checkbox" name="choicesSelected" id="choice-@choice.Id" value="@choice.Id"
               checked>
                }
                else
                {
                    <input class="form-check-input" type="checkbox" name="choicesSelected" id="choice-@choice.Id" value="@choice.Id">
                }

                <label class="form-check-label" for="choice-@choice.Id">
                    @choice.Label
                </label>
            </div>
        }
    }
    else
    {
        <p> Choisis une réponse :</p>

        @foreach (Choice choice in Model.Choices)
        {


             <div class="form-check">

                @if (Model.ChoicesSelected != null && Model.ChoicesSelected.Any(x => x.Id == choice.Id))
                {

                    <input class="form-check-input" type="radio" name="choicesSelected" id="choice-@choice.Id" value="@choice.Id"
               checked>
                }
                else
                {
                    <input class="form-check-input" type="radio" name="choicesSelected" id="choice-@choice.Id" value="@choice.Id">
                }

                <label class="form-check-label" for="choice-@choice.Id">
                    @choice.Label
                </label>
            </div>
        }

    }

    @if (Context.User.Identity.IsAuthenticated && !Model.IsDisabled)
    {
        @if (Model.UserAlreadyVoted)
        {
            <div class="form-group">
                <input type="submit" value="Modifier mon vote !" class="btn btn-primary" />
            </div>
        }
        else
        {
            <div class="form-group">
                <input type="submit" value="Voter" class="btn btn-primary" />
            </div>
        }

    }
    else
    {
        <div class="form-group">
            <input type="submit" value="Voter" class="btn btn-primary" disabled />
        </div>

    }



</form>

